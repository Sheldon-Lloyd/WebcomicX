function accordion(b){var b=$(b).parent(),c=$(".accordion").height(),a=$(".inner-collection").position();if(!$(".accordion",b).is(":visible")){$(".accordion",b).slideDown(500);if($(".accordion",b).css("display")=="inline"){$(".accordion",b).css("display","initial")}if(a!="undefined"){a=a.top;var d=c+a;$(".inner-collection").animate({top:d},500)}}else{$(".accordion",b).slideUp(500);if($(".accordion",b).css("display")=="inline"){$(".accordion",b).css("display","initial")}$(".inner-collection").animate({top:"80"},500)}}formdata=false;function showUploadedItem(a){var c=0,f=a.files.length,d,g,b;e2=$(a).parent();for(;c<f;c++){b=a.files[c];if(!!b.type.match(/image.*/)){if(window.FileReader){g=new FileReader();g.onloadend=function(h){var i="<img src='"+h.target.result+"' width='100%' height='auto' style='max-width:700px'>";$(".image-list",e2).html(i)};g.readAsDataURL(b)}if(formdata){formdata.append("images[]",b)}}}}if(window.FormData){formdata=new FormData()}function uploadImage(a){var c=0,f=a.files.length,d,g,b;e2=$(a).parent();$(".response",e2).html("Uploading . . .");collectionNode=$(e2).closest(".collection-item").index();for(;c<f;c++){b=a.files[c];if(!!b.type.match(/image.*/)){if(window.FileReader){g=new FileReader();g.onloadend=function(h){var i="<img src='"+h.target.result+"' width='100%' height='auto'>";$(".image-list",e2).html(i)};g.readAsDataURL(b)}if(formdata){formdata.append("images[]",b)}}}if(formdata){$.ajax({url:"/webcomicx/admin/controlers/edit-collection-cover/"+collectionNode,type:"POST",data:formdata,processData:false,contentType:false,success:function(h){$(".response",e2).html(h);$($(e2).closest(".collection-item")).css("backgroundImage","url(/content/uploads/covers/thumbnail/"+h+")")}})}}function newCollection(){$("#newCollection").submit(function(c){c.preventDefault();var a=$(this),b=a.find('input[name="createCollect"]').val(),f=a.attr("action");var d=$.post(f,{s:b},function(h){var g='<li class="item collection-item" style="background-image:url(/content/uploads/covers/thumbnail);background-size: contain;background-position:center;background-repeat: no-repeat" id="'+($("#collections li").length+1)+'" ondrop="dropComic(this, event)" ondragenter="return false" ondragover="return false"><a onclick="popup(this)" title="Edit Collection" class="action" style="position: initial;margin-left: 3px;">Edit</a><form id="deleteCollection" action="/webcomicx/admin/controlers/delete-collection" method="post"><button class="action" value="'+($("#collections li").length+1)+'" type="submit" name="collectionNo" onclick="deleteCollection(this)">&times;</button></form>'+h+"</li>";$("#collections").append(g);$("#collection").focus()})})}function deleteCollection(a){var b=$(a).parent();$(b).submit(function(g){g.preventDefault();var c=$(this),d=$(b).parent().index()+1,i=c.attr("action");var f=confirm("Are you sure you want to delete this collection");if(f==true){var h=$.post(i,{collectionNo:d},function(j){$(b).parent().remove()})}else{}})}function nameCollection(){event.preventDefault();var a=$("#nameCollection"),b=a.find('input[name="collectionName"]').val(),c=a.find('input[name="collectionNo"]').val(),f=a.attr("action");var d=$.post(f,{collectionName:b,collectionNo:c},function(i){var g=$("#collection").parent().parent();var h='<a onclick="popup(this)" title="Edit Collection" class="action" style="position: initial;margin-left: 3px;">Edit</a><span><a onclick="window.location=$(this).closest(\'.collection-item\').index()+1">'+$("#collection").val()+'</a></span><form id="deleteCollection" action="/webcomicx/admin/controlers/delete-collection" method="post"><button class="action" value="'+($("#collections li").length+1)+'" type="submit" name="collectionNo" onclick="deleteCollection(this)">&times;</button></form><div class="feedback"></div> <div class="pop-up"> <div id="title"> <h2>Edit Collection</h2> <a onclick="popup(this)" id="close">&times;</a> <div class="clear-fix"></div> </div> <div id ="box"> <form class="imageUpload" method="post" enctype="multipart/form-data" action="/webcomicx/admin/controlers/edit-collection-cover/"> <input type="file" name="image" id="images" onchange="uploadImage(this)" />  <div class="response"></div> <div class="image-list"></div> </form> <form enctype="multipart/form-data" action="/webcomicx/admin/controlers/edit-collection" method="post" class="collectionInfo"> <input type="hidden" name="cover"> <label>Cover Attribution</label> <input type="text" name="attribution" value=""> <label>Collection Name</label> <input type="text" value="'+$("#collection").val()+'" name="title"> <label>Collection Description</label> <textarea name="description"></textarea> <a onclick="popup(this)" style="cursor: pointer">Cancel</a> <button onclick="updateCollection(this)" type="submit" name="collection" value="">Save</button> </form> </div> </div>';g.empty();g.html(h)})}function popup(a){a=$(a).closest(".item");$(".pop-up",a).toggleClass("is-hidden")}function closePrompt(){$(".prompt").fadeOut()}function updateCollection(a){var b=a;var a=$(a).parent();$(a).submit(function(g){g.preventDefault();var c=$(this),h=c.find('input[name="title"]').val(),d=c.find('input[name="attribution"]').val(),f=c.find('textarea[name="description"]').val(),j=c.closest(".collection-item"),i=j.index(),l=c.attr("action");var k=$.post(l,{title:h,attribution:d,description:f,collection:i},function(m){popup(b);$(".collection-name a",j).html(h);$(".prompt").html("Your collection has been saved! <a onclick='closePrompt()'>&times;</a>");$(".prompt").show();setTimeout(function(){closePrompt()},9001)})})}$(document).ready(function(){if("draggable" in document.createElement("span")){$("#comic-list li").css("cursor","move")}});var comicElement;function dragComic(a,b){b.dataTransfer.setData("comic",a.id);comicElement=a;$(".collection-item").addClass("border-highlight")}function dropComic(f,c){var b=c.dataTransfer.getData("comic");if($(".feedback").is(":animated")){$(".feedback").stop().animate({opacity:"100"})}$(".feedback span",f).html("Comic "+b+" added to collection!");$(".feedback",f).show();setTimeout(function(){$(".feedback",f).fadeOut(1000)},1000);var a=$(f).index()+1;var d=$.post("/webcomicx/admin/controlers/change-collection",{comicNo:b,collection:a},function(g){var h=window.location.pathname;h=h.split("/");if(h[3]!=undefined){if(h[3]!=a){comicElement.remove()}}})}function includeAbout(){e=document.getElementById("about");var a=$(e).val();if(e.checked!=1){a="False"}$.post("/webcomicx/admin/controlers/include-about",{about:a})}function includeCharacters(){e=document.getElementById("characters");var a=$(e).val();if(e.checked!=1){a="False"}$.post("/webcomicx/admin/controlers/include-characters",{characters:a})}$(document).ready(function(){var b="";var a="";$("#sortable").sortable({start:function(c,d){b=$(d.item).index()},update:function(c,f){a=$(f.item).index();var d=$.post("/webcomicx/admin/controlers/character-position",{oldPosition:b,newPosition:a})}}).disableSelection();$(".sort").submit(function(){event.preventDefault();b=$(this).closest("#sortable li").index();a=0;e=$(this).closest("#sortable li");e.clone().prependTo("#sortable");e.remove();var c=$.post("/webcomicx/admin/controlers/character-position",{oldPosition:b,newPosition:a})});$("#deleteCharacter").submit(function(){event.preventDefault();e=$(this).closest("#sortable li");characterNode=e.index();e.remove();var c=$.post("/webcomicx/admin/controlers/delete-character",{characterNode:characterNode})})});function deletePrompt(a){$(a).closest(".item-list li").children(".delete").toggle()}function checkButton(){if($(this).has("#checkbox")){$("label.button").toggleClass("is-checked is-unchecked")}else{$("label.button").removeClass("is-checked");$("label.button").addClass("is-unchecked");$(this).removeClass("is-unchecked");$(this).addClass("is-checked")}}function getLicense(){var a=$("#license").val();if(a=="Other"){$("#licenseValue").attr("type","text");$("#license").css("max-width","150px")}else{$("#licenseValue").attr("type","hidden");$("#license").css("max-width","700px")}$("#licenseValue").val("")}$(document).ready(function(){$(".widget").sortable({connectWith:".widget",items:"li:not(.non-widget)",cancel:".ui-state-disabled"}).disableSelection()});function addWidget(b){var a=$(b).closest(".widget");var c=a.attr("data-position");newWidget='<li class="item ui-state-default" id="null"><form class="sort"><input type="hidden" name="position" value=""><input type="hidden" name="index" value=""><input type="hidden" name="id" value=""></form><form method="post" action="/webcomicx/admin/controlers/delete-widget"><button onclick="deleteWidget(this)" id="delete" value="" name="id">&times;</button></form><a id="editWidget" onclick="popup(this)">Edit widget</a><div class="pop-up"><div id="title"><h2>Edit Widget</h2><a onclick="$(this).closest(\'.item\').remove()" id="close">&times;</a><div class="clear-fix"></div></div><div id ="box"><form action="/webcomicx/admin/controlers/save-widget" method="post" class="ui-state-disabled"><label>Widget Name</label><input type="hidden" name="position" value="'+c+'"><input type="text" name="name" value=""><label>Html/JavaScript</label><textarea name="code"></textarea><br><a onclick="$(this).closest(\'.item\').remove()" style="cursor: pointer">Cancel</a><button onclick="saveWidget(this)" type="submit" name="id" value="">Save</button></form></div></div></li>';$(b).closest(".widget-placeholder").after(newWidget)}function saveLayout(){$(".prompt").show();$(".prompt").html("Saving Layout...").show();$(".sort").each(function(){var a=$(this).closest(".widget");var g=a.attr("data-position");var c=$(this).closest(".item");var b=g;var f=$(this).closest(".item").index();var d=c.attr("id");$.ajax({type:"POST",async:false,url:"/webcomicx/admin/controlers/sort-widgets",data:{position:b,index:f,id:d}})});$(".prompt").html("Layout Saved! <a onclick='closePrompt()'>&times;</a>");setTimeout(function(){closePrompt()},9001)}function saveWidget(c){event.preventDefault();var d=$(c).closest("form"),f=d.find('input[name="name"]').val(),a=d.find('textarea[name="code"]').val(),b=$(c).closest(".widget"),i=$(c).closest(".item"),h=b.attr("data-position"),j=d.find('button[name="id"]').val();var g=$.ajax({type:"POST",async:false,url:"/webcomicx/admin/controlers/save-widget",data:{position:h,id:j,name:f,code:a},success:function(k){}});$("input").blur();$("textarea").blur();g.done(function(k){$("#temp-container").html(k.replace(/\s/g,""));var l=$("#temp-container #text").html();$(c).closest(".item").find("#editWidget").html("Edit "+f+" widget");d.find('button[name="id"]').val(k.replace(/\s/g,""));$("#delete",i).val(k.replace(/\s/g,""));i.attr("id",k.replace(/\s/g,""));popup(c)})}function deleteWidget(a){event.preventDefault();var d=$(a).val(),c=$(a).closest(".item");var b=$.ajax({type:"POST",async:false,url:"/webcomicx/admin/controlers/delete-widget",data:{id:d}});c.remove()}function saveComments(a){event.preventDefault();var b=$(a).closest("form"),c=b.find('select[name="name"]').val();var d=$.ajax({type:"POST",async:false,url:"/webcomicx/admin/controlers/comment-plugin-selection",data:{name:c}});$("#commentPluginSettings").html("Loading...");d.done(function(f){$("#commentPluginSettings").load("/content/plugins/comments/"+c+"/settings/settings.cshtml",function(g,h,i){if(h=="error"){$("#commentPluginSettings").html("")}});$("#commentPluginName").html("("+c+")")})}function blogSettings(a){$(".type").hide();var b=$(a).val();$("#"+b).show()}function externalBlog(){$("#external").submit(function(a){a.preventDefault();$("#blogFeed").html("<h3>Loading Blog Posts...</h3>");$(".pop-up").hide();var f=$("#external").find("input[name='url']").val();var b=$("#external").find("input[name='feed']").val();var d=$.ajax({type:"POST",async:false,url:"/webcomicx/admin/controlers/external-blog",data:{url:f,feed:b}});var c=$.ajax({type:"POST",async:false,url:"/webcomicx/admin/controlers/blog-settings",data:{setting:"external"}});c.done(function(g){$("#blogFeed").load("/webcomicx/views/external-blog?t=Admin")})})}function webcomicxBlog(){$("#webcomicx").submit(function(b){b.preventDefault();$("#blogFeed").html("<h3>Loading Blog Posts...</h3>");$(".pop-up").hide();var a=$("#webcomicx").find("textarea[name='description']").val();var d=$.ajax({type:"POST",async:true,url:"/webcomicx/admin/controlers/webcomicx-blog",data:{description:a}});var c=$.ajax({type:"POST",async:true,url:"/webcomicx/admin/controlers/blog-settings",data:{setting:"webcomicx"}});c.done(function(f){$("#blogFeed").load("/webcomicx/views/webcomicx-blog?t=Admin")})})}function welcomeDismiss(){$(".message-guide").remove();var a=$.post("/webcomicx/admin/controlers/welcome-dismiss",{dismiss:"dismiss"})}function pageWidth(a){var b=$(a).val().replace("px","");$("span.pageWidth").html(b+"px");$("iframe").contents().find(".page").css("max-width",b+"px")}function pageFont(a){var b=$(a).val().replace("px","");$("iframe").contents().find("body").css("font-size",b+"px")}function backgroundColor(c,d){var b=$(c).closest(".colorpicker-container"),d=$(c).attr("data-element"),f=$(c).closest(".design-option").attr("data-element"),a=$(c).val(),i=$("iframe").contents().find(d);if(a!=""){if(a.substring(0,1)!="#"){a="#"+a}i.css("background",a)}else{i.css("background",a)}var j=$("#sitePreview").height(),h=$("#sitePreview").contents().find("body").scrollTop(),g=i.offset().top;elementScrollPosition=g-h;if(elementScrollPosition<0||elementScrollPosition>j){$("iframe").contents().scrollTop($("iframe").contents().find(f).first().offset().top)}}function textColor(b,c){var a=$(b).val(),d=$(b).closest(".design-option").attr("data-element");iframeElement=$("iframe").contents().find(d);if(a.substring(0,1)!="#"){a="#"+a}$("iframe").contents().find(c).css("color",a);var h=$("#sitePreview").height(),g=$("#sitePreview").contents().find("body").scrollTop(),f=iframeElement.offset().top;elementScrollPosition=f-g;if(elementScrollPosition<0||elementScrollPosition>h){$("iframe").contents().scrollTop($("iframe").contents().find(d).first().offset().top)}}function designOptions(a){var b="#"+$(a).val();$(".design-option").hide();$(b).show()}function toogleDesigner(){if($(".designer").height()>$(".min-max-designer").height()+3){$(".designer-inner").hide();$(".designer").animate({height:$(".min-max-designer").height()+3},250);$(".designer").css("overflow","hidden");$(".site-preview").animate({top:$(".min-max-designer").height()+3},250);$(".min-max-designer a").html("Expand Designer")}else{$(".designer-inner").show();$(".designer").animate({height:230},0);$(".designer").css("overflow","hidden");$(".site-preview").animate({top:230},250);$(".min-max-designer a").html("Minimize Designer")}}function useLogo(){e=document.getElementById("includeLogo");var b=$(e).val();if(e.checked!=1){$("#logo").hide();$("#logo").val("");$("iframe").contents().find(".logo").css("background","none");$("iframe").contents().find(".logo").css("text-indent","0");$("iframe").contents().find(".logo").css("height","auto");$("iframe").contents().find(".logo").css("width","auto")}else{$("#logo").css("display","inline-block");imgUrl=$("#logo").attr("data-img");if(imgUrl!=""){var a=new Image();a.src="/content/uploads/design/"+imgUrl;$("iframe").contents().find(".logo").css("width",a.width+"px");$("iframe").contents().find(".logo").css("height",a.height+"px");$("iframe").contents().find(".logo").css("background","url('"+a.src+"') no-repeat");$("iframe").contents().find(".logo").css("text-align","left");$("iframe").contents().find(".logo").css("text-indent","-999999px");$("iframe").contents().find(".logo").css("margin","auto");$("iframe").contents().find(".logo").css("line-height",a.height+"px");$("iframe").contents().find(".logo").css("display","inline-block");$("iframe").contents().find(".logo").css("display","inline-block")}}}function rgb2hex(b){b=b.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/);function a(c){return("0"+parseInt(c).toString(16)).slice(-2)}return"#"+a(b[1])+a(b[2])+a(b[3])}$("iframe").load(function(){loadStyles()});function showUploadedLogo(a){var c=0,f=a.files.length,d,g,b;for(;c<f;c++){b=a.files[c];if(!!b.type.match(/image.*/)){if(window.FileReader){g=new FileReader();g.onloadend=function(h){imgUrl=h.target.result;$("#logo").attr("data-img",h.target.result);if(imgUrl!=""){var i=new Image();i.src=imgUrl;$("iframe").contents().find(".logo").css("width",i.width+"px");$("iframe").contents().find(".logo").css("height",i.height+"px");$("iframe").contents().find(".logo").css("background","url('"+i.src+"') no-repeat");$("iframe").contents().find(".logo").css("text-align","left");$("iframe").contents().find(".logo").css("text-indent","-999999px");$("iframe").contents().find(".logo").css("margin","auto");$("iframe").contents().find(".logo").css("line-height",i.height+"px");$("iframe").contents().find(".logo").css("display","inline-block");$("iframe").contents().find(".logo").css("display","inline-block")}};g.readAsDataURL(b)}if(formdata){formdata.append("images[]",b)}}}}$(document).ready(function(){$(".defaultWidth").click(function(){var a=$(this).closest(".pageWidth-container");$("iframe").contents().find(".page").css("max-width","");var b=$("iframe").contents().find(".page").css("max-width");$("input.pageWidth",a).val(b.replace("px",""));$("span.pageWidth",a).html(b)});$(".defaultBackground").click(function(){var b=$(this).closest(".colorpicker-container"),c=$(".colorpicker",b).attr("data-element");$("iframe").contents().find(c).css("background","");var a=$("iframe").contents().find(c).css("background-color");$(".sp-colorpicker",b).removeClass("is-pressed");$(this).addClass("is-pressed");$(".colorpicker",b).val("")});$(".defaultTextColor").click(function(){var b=$(this).closest(".colorpicker-container"),c=$(".colorpicker",b).attr("data-element");$("iframe").contents().find(c).css("color","");var a=$("iframe").contents().find(c).css("background-color");$(".sp-colorpicker",b).removeClass("is-pressed");$(this).addClass("is-pressed");$(".colorpicker",b).val("")});$(".colorpicker").change(function(){var a=$(this).closest(".colorpicker-container"),b=$(".colorpicker",a).attr("data-element");if($(this).value!=""){$(".defaultBackground",a).removeClass("is-pressed");$(".defaultTextColor",a).removeClass("is-pressed");$(".sp-colorpicker",a).addClass("is-pressed")}})});
