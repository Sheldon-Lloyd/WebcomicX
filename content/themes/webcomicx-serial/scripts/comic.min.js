(function(a){a.fn.webcomicXreader=function(k){var e={comicNo:1,pageNo:"undefined"},n=a.extend({},e,k);var c="/content/xml/comics/comic-list.xml",d="/content/xml/comics/comic-"+n.comicNo+".xml",j="/content/xml/comics/comic-"+(n.comicNo+1)+".xml",m="/content/xml/comics/comic-"+(n.comicNo-1)+".xml";var g=function(){var p=h(d),u=p.getElementsByTagName("Page");var r=function(){var y=new Image(),w=l.i();try{y.src="/content/uploads/pages/"+(u[w].getElementsByTagName("Image")[0].childNodes[0].nodeValue);y='<img src="'+y.src+'" width="auto" height="auto">'}catch(v){if(g.content()==""){y='<div class="comic-placeholder"><div class="inner-placeholder"><h3 class="comic-placeholder-title">Page '+l.No()+"</h3></div></div>"}else{y='<article class="comic-placeholder"><h3>Page '+l.No()+"</h3>"+g.content()+"</article>"}}for(var x=(w+1);x<(w+3);x++){try{var z=new Image();if(5>w&&(u[x].getElementsByTagName("Image")[0].childNodes[0].nodeValue!="")){z.src="/content/uploads/pages/"+(u[x].getElementsByTagName("Image")[0].childNodes[0].nodeValue)}}catch(v){}}return y};var t=function(){var x=["January","February","March","April","May","June","July","August","September","October","November","December"],w=l.i(),v=new Date(u[w].getElementsByTagName("Date")[0].childNodes[0].nodeValue);t=x[v.getMonth()]+", "+v.getDate()+" "+v.getFullYear();return t};var o=function(){i=l.i();try{o="By "+(u[i].getElementsByTagName("Author")[0].childNodes[0].nodeValue)}catch(v){o=""}return o};var s=function(){var z=l.No()>0?l.No():1,w=a(".previous"),v=a(".next");a(".pages select").val(z);a("#comicHeading h2 #pageNo").remove();if(z>0){a("#comicHeading h2").html(a("#comicHeading h2").html()+" <span id='pageNo'>&raquo; <span>Page "+z)+"</span></span>"}if(z<u.length){v.show();v.attr("href","#!/page/"+(z+1))}else{var y=h(c),x=y.getElementsByTagName("Comic");if(n.comicNo<x.length){v.show();v.attr("href","/comic/read/"+(n.comicNo+1)+"/#!/page/1")}else{v.removeAttr("href");v.hide()}}if(z>1){w.show();if(n.pageNo!=="undefined"){w.attr("href","/comic/read/"+n.comicNo+"/#!/page/"+(z+-1))}else{w.attr("href","#!/page/"+(z+-1))}}else{if(z<2&&n.comicNo!==1){var B=h(m),A=B.getElementsByTagName("Page"),C=A.length>0?A.length:1;w.attr("href","/comic/read/"+(n.comicNo+-1)+"/#!/page/"+C)}else{if(n.comicNo==1){w.removeAttr("href");w.hide()}}}};var q=function(){i=l.i();try{q="<div>"+(u[i].getElementsByTagName("Content")[0].childNodes[0].nodeValue).split(/\r?\n/).join("<br>")+"</div>"}catch(v){q=""}return q};return{image:r,pubDate:t,author:o,pagination:s,content:q}}();function h(o){if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest()}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.open("GET",o,false);xmlhttp.send();xmlFile=xmlhttp.responseXML;return xmlFile}function f(){var p=a(window).height(),q=a("body").scrollTop(),o=a(".webcomic").offset().top;elementScrollPosition=o-q;if(elementScrollPosition<0||elementScrollPosition>p){a(function(){a(document).scrollTop(0)})}a("#pageContent").html("<figure>"+g.image()+'<figcaption class="is-collapsed"><div class="collapse-container"><a role="button" class="collapse-button">&#x25BC;</a></div><div class="inner-figcaption"><h5>Page '+l.No()+" "+g.author()+"</h5>"+g.content()+"</div></figcaption></figure>")}var l=function(){var q=function(){var s=window.location.hash.match(/\d+/)|0,t=n.pageNo!=="undefined"?n.pageNo:s>0?s:1;return t};var o=function(){o=l.No()>0?l.No()-1:0;return o};var p=function(){var s=a(".webcomic .next").attr("href");if(s!==undefined){window.location=s}};var r=function(){var s=a(".webcomic .previous").attr("href");if(s!==undefined){window.location=s}};return{No:q,i:o,next:p,previous:r}}();a(window).on("hashchange",function(){f();g.pagination();a(".webcomic img").click(function(){$container=a(this).closest(".webcomic");a("figcaption",$container).toggleClass("is-collapsed")});a(".webcomic .collapse-button").click(function(){$container=a(this).closest(".webcomic");a("figcaption",$container).toggleClass("is-collapsed")});var o=window.location.toString();if(o.split("#!").length==1){if(o.split("#").length==2){o="#!/page/"+l.No();window.location=o}}});a(window).trigger("hashchange");a("#page-nav").on("change",function(){var o=this;gotoUrl="#!/page/"+o.options[o.selectedIndex].value;window.location=gotoUrl;i=o.selectedIndex});a("#chapter-nav").on("change",function(){var o=this;var p="/comic/read/"+o.options[o.selectedIndex].value+"/";window.location=p;i=o.selectedIndex});function b(o){o=o||window.event;if(o.keyCode==37){l.previous()}if(o.keyCode==39){l.next()}}document.onkeydown=b}})(jQuery);