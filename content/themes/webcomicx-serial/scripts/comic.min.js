(function(a){a.fn.webcomicXreader=function(k){var e={comicNo:1,pageNo:"undefined"},n=a.extend({},e,k);var c="/content/xml/comics/comic-list.xml",d="/content/xml/comics/comic-"+n.comicNo+".xml",j="/content/xml/comics/comic-"+(n.comicNo+1)+".xml",m="/content/xml/comics/comic-"+(n.comicNo-1)+".xml";var g=function(){var p=h(d),v;try{v=p.getElementsByTagName("Page")}catch(r){v=""}var s=function(){var z=new Image(),x=l.i();try{z.src="/content/uploads/pages/"+(v[x].getElementsByTagName("Image")[0].childNodes[0].nodeValue);z='<img src="'+z.src+'" width="auto" height="auto">'}catch(w){if(g.content()==""){z='<div class="comic-placeholder"><div class="inner-placeholder"><h3 class="comic-placeholder-title">Page '+l.No()+"</h3></div></div>"}else{z='<article class="comic-placeholder"><h3>Page '+l.No()+"</h3>"+g.content()+"</article>"}}for(var y=(x+1);y<(x+3);y++){try{var A=new Image();if(5>x&&(v[y].getElementsByTagName("Image")[0].childNodes[0].nodeValue!="")){A.src="/content/uploads/pages/"+(v[y].getElementsByTagName("Image")[0].childNodes[0].nodeValue)}}catch(w){}}return z};var u=function(){var y=["January","February","March","April","May","June","July","August","September","October","November","December"],x=l.i(),w=new Date(v[x].getElementsByTagName("Date")[0].childNodes[0].nodeValue);u=y[w.getMonth()]+", "+w.getDate()+" "+w.getFullYear();return u};var o=function(){i=l.i();try{o="By "+(v[i].getElementsByTagName("Author")[0].childNodes[0].nodeValue)}catch(w){o=""}return o};var t=function(){var A=l.No()>0?l.No():1,x=a(".previous"),w=a(".next");a(".pages select").val(A);a("#comicHeading h2 #pageNo").remove();if(A>0){a("#comicHeading h2").html(a("#comicHeading h2").html()+" <span id='pageNo'>&raquo; <span>Page "+A)+"</span></span>"}if(A<v.length){w.show();w.attr("href","#!/page/"+(A+1))}else{var z=h(c),y=z.getElementsByTagName("Comic");if(n.comicNo<y.length){w.show();w.attr("href","/comic/read/"+(n.comicNo+1)+"/#!/page/1")}else{w.removeAttr("href");w.hide()}}if(A>1){x.show();if(n.pageNo!=="undefined"){x.attr("href","/comic/read/"+n.comicNo+"/#!/page/"+(A+-1))}else{x.attr("href","#!/page/"+(A+-1))}}else{if(A<2&&n.comicNo>1){var C=h(m),B=C.getElementsByTagName("Page"),D=B.length>0?B.length:1;x.attr("href","/comic/read/"+(n.comicNo+-1)+"/#!/page/"+D)}else{if(n.comicNo==1){x.removeAttr("href");x.hide()}}}};var q=function(){i=l.i();try{q="<div>"+(v[i].getElementsByTagName("Content")[0].childNodes[0].nodeValue).split(/\r?\n/).join("<br>")+"</div>"}catch(w){q=""}return q};return{image:s,pubDate:u,author:o,pagination:t,content:q}}();function h(o){if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest()}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.open("GET",o,false);xmlhttp.send();xmlFile=xmlhttp.responseXML;return xmlFile}function f(){var p=a(window).height(),q=a("body").scrollTop(),o=a(".webcomic").offset().top;elementScrollPosition=o-q;if(elementScrollPosition<0||elementScrollPosition>p){a(function(){a(document).scrollTop(0)})}a("#pageContent").html("<figure>"+g.image()+'<figcaption class="is-collapsed"><div class="collapse-container"><a role="button" class="collapse-button">&#x25BC;</a></div><div class="inner-figcaption"><h5>Page '+l.No()+" "+g.author()+"</h5>"+g.content()+"</div></figcaption></figure>")}var l=function(){var q=function(){var s=window.location.hash.match(/\d+/)|0,t=n.pageNo!=="undefined"?n.pageNo:s>0?s:1;return t};var o=function(){o=l.No()>0?l.No()-1:0;return o};var p=function(){var s=a(".webcomic .next").attr("href");if(s!==undefined){window.location=s}};var r=function(){var s=a(".webcomic .previous").attr("href");if(s!==undefined){window.location=s}};return{No:q,i:o,next:p,previous:r}}();a(window).on("hashchange",function(){f();g.pagination();a(".webcomic img").click(function(){$container=a(this).closest(".webcomic");a("figcaption",$container).toggleClass("is-collapsed")});a(".webcomic .collapse-button").click(function(){$container=a(this).closest(".webcomic");a("figcaption",$container).toggleClass("is-collapsed")});var o=window.location.toString();if(o.split("#!").length==1){if(o.split("#").length==2){o="#!/page/"+l.No();window.location=o}}});a(window).trigger("hashchange");a("#page-nav").on("change",function(){var o=this;gotoUrl="#!/page/"+o.options[o.selectedIndex].value;window.location=gotoUrl;i=o.selectedIndex});a("#chapter-nav").on("change",function(){var o=this;var p="/comic/read/"+o.options[o.selectedIndex].value+"/";window.location=p;i=o.selectedIndex});function b(o){o=o||window.event;if(o.keyCode==37){l.previous()}if(o.keyCode==39){l.next()}}document.onkeydown=b}})(jQuery);