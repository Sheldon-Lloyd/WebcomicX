var pageNo=window.location.hash.match(/\d+/)|0;var i=pageNo-1;var navLink="";var url=window.location.pathname;url=url.split("/");currentComic=parseInt(url[3]);var preComic=currentComic-1;var xmlDoc2;var x2;var x;var comicList;var comicCount;var filename="/content/xml/comics/comic-"+currentComic+".xml";function displayPage(){if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest()}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.open("GET",filename,false);xmlhttp.send();xmlDoc=xmlhttp.responseXML;xmlhttp.open("GET","/content/xml/comics/comic-list.xml",false);xmlhttp.send();comicListXml=xmlhttp.responseXML;comicList=comicListXml.getElementsByTagName("Comic");if(preComic>0){xmlhttp.open("GET","/content/xml/comics/comic-"+preComic+".xml",false);xmlhttp.send();xmlDoc2=xmlhttp.responseXML;x2=xmlDoc2.getElementsByTagName("Page")}x=xmlDoc.getElementsByTagName("Page");var j="";var a="";var n="";pubDate;try{pubDate=new Date(comicList[(currentComic-1)].getElementsByTagName("Date")[0].childNodes[0].nodeValue)}catch(e){}try{if(pageNo>0&&x.length>0){n=(x[i].getElementsByTagName("Content")[0].childNodes[0].nodeValue.split(/\r?\n/).join("<br>"))}else{n=(comicList[(currentComic-1)].getElementsByTagName("Content")[0].childNodes[0].nodeValue.split(/\r?\n/).join("<br>"))}}catch(e){}try{a="By "+(x[i].getElementsByTagName("Author")[0].childNodes[0].nodeValue)+" on "}catch(e){}try{j=(x[i].getElementsByTagName("Image")[0].childNodes[0].nodeValue)}catch(d){}try{pubDate=new Date(x[i].getElementsByTagName("Date")[0].childNodes[0].nodeValue)}catch(d){}$("#authorComments").html(n);var k=new Image();if(j!=""){k.src="/content/uploads/pages/"+j;k.clientWidth}var l=["January","February","March","April","May","June","July","August","September","October","November","December"];var g;try{g=l[pubDate.getMonth()]+", "+pubDate.getDate()+" "+pubDate.getFullYear()}catch(e){}if(j!=""){$("#pageContent").html("<img src='"+k.src+"' height='auto' width='auto'>")}else{var b=comicList[(currentComic-1)].getElementsByTagName("Title")[0].childNodes[0].nodeValue,m='<div class="comic-placeholder"><div class="inner-placeholder"><h3 class="comic-placeholder-title">'+b+"</h3></div></div>";$("#pageContent").html(m)}$("#pubDate").html(a+" "+g);for(var h=(i+1);h<(i+3);h++){try{var k=new Image();if((x[h].getElementsByTagName("Image")[0].childNodes[0].nodeValue!="")){k.src="/content/uploads/pages/"+(x[h].getElementsByTagName("Image")[0].childNodes[0].nodeValue)}}catch(f){}}if(pageNo>0&&x.length>0){$("#pageNo").html((i+1));$("#page").val(pageNo)}navLink="#!/page/"+(i+1);if(i>0){$("a.previous").attr("href","#!/page/"+(pageNo-1))}if(i<x.length-1){$("a.next").attr("href","#!/page/"+(pageNo+1))}else{if(pageNo==x.length){$("a.next").attr("href","#!/page/"+(pageNo))}}editNav();var o=$(window).height(),p=$("body").scrollTop(),c=$(".webcomic").offset().top;elementScrollPosition=c-p;if(elementScrollPosition<0||elementScrollPosition>o){$(function(){$(document).scrollTop(0)})}}function go(b){var d=b.id;var a=document.getElementById(d);var c="/comic/read/"+a.options[a.selectedIndex].value;window.location=c}function pageGo(b){var c=b.id;var a=document.getElementById(c);gotoUrl="#!/page/"+a.options[a.selectedIndex].value;window.location=gotoUrl;i=a.selectedIndex}function checkKey(a){a=a||window.event;if(a.keyCode==37){previous()}if(a.keyCode==39){next()}}document.onkeydown=checkKey;function next(){if(i<x.length-1){i++;navLink="#!/page/"+(i+1);window.location=navLink;displayPage()}else{if(comicList.length>currentComic){window.location="/comic/read/"+(currentComic+1)+"/#!/page/1"}}this.event.returnValue=false}function previous(){if(i>0){i--;navLink="#!/page/"+(i+1);window.location=navLink;displayPage()}else{if(x2!=undefined){window.location="/comic/read/"+preComic+"/#!/page/"+(x2.length)}}this.event.returnValue=false}function editNav(){if(currentComic<2){if(i<=0){$(".previous").hide()}else{$(".previous").show()}}if(comicList.length==currentComic){if(i>=x.length-1){$(".next").hide()}else{$(".next").show()}}}$(window).load(function(){$(window).on("hashchange",function(){pageNo=window.location.hash.match(/\d+/)|0;i=pageNo-1;displayPage();if(i>0){$("a.previous").attr("href","#!/page/"+(pageNo-1))}if(i<x.length-1){$("a.next").attr("href","#!/page/"+(pageNo+1))}else{if(pageNo==x.length){$("a.next").attr("href","#!/page/"+(pageNo))}}});$(window).trigger("hashchange")});function horizontalNext(a){a=$(a).parent();pages=$(a).children(".comic-collection");scrollPosition=$(pages).scrollLeft();var b;$(".previous",a).show();w=$(pages).width();sw=$(pages).children("ul")[0].scrollWidth-w;if(scrollPosition<sw){b=scrollPosition+w;$(pages).animate({scrollLeft:b},500)}}function toggleScrollBtn(a){a=$(a).closest("li.accordion");pages=$(".comic-collection",a);scrollPosition=$(".comic-collection",a).scrollLeft();if(scrollPosition<=0){$(".previous",a).hide()}else{$(".previous",a).show()}w=$(pages).width();sw=$(pages).children("ul")[0].scrollWidth-w;if(scrollPosition>=sw){$(".next",a).hide()}else{$(".next",a).show()}}function horizontalBack(a){a=$(a).parent();pages=$(a).children(".comic-collection");$(".next",a).show();scrollPosition=$(pages).scrollLeft();w=$(pages).width();if(scrollPosition>0){scrollRight=scrollPosition-w;$(pages).animate({scrollLeft:scrollRight},500)}}function accordion(a){a=$(a).parent();$("h4.accordion span").html("+");$("div.is-hidden").slideUp(222);if(!$(".is-hidden",a).is(":visible")){$("div.is-hidden",a).slideToggle(222);if($("h4.accordion span",a).text()=="+"){$("h4.accordion span",a).html("&times;")}else{$("h4.accordion h4 span",a).html("+")}}};